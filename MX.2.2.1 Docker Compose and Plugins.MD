# Docker Compose Overview
Docker Compose is a powerful tool that allows us to define and manage multi-container Docker applications. It is particularly useful when working with microservice ecosystems, as it enables the easy launch and coordination of multiple containers simultaneously. With Compose, we can configure networking, define infrastructure as code, and meet scalability requirements.


## Compose file
The Compose file is the heart of Docker Compose, it consists of a YAML file (`docker-compose.yml`) that allows to define an application ecosystem including services, networking, disk space and more.

### Key syntax elements of the Compose file
The `docker-compose.yaml` file follows a hierarchical structure by the use of identations.
- **version**: Specifies the Compose version to use.
- **services**: Defines the containers of the application, each service represents a container.
  - **service**: Name of the single service.
    - **image**: Specifies the image to use for the service.
    - **build**: Alternative to `image`, allows to build an image from a specific dockerfile.
    - **ports**: Maps the host's ports.
    - **volumes**: Allows to share data between container and host or just between containers.
    - **networks**: Defines the networks which the containers will utilize to communicate.

The following [example](https://github.com/NakajimaAkemi/Microservices-containerization/tree/master/workdir/simple-compose) shows the basic structure of `docker-compose.yml` that defines an ecosystem composed of a single Flask application mapped to the port `5000`.
```yaml
version: '3'
services:
  flask:
    build: ./app
    ports:
      - "5000:5000"
```


### Lifecycle di Docker Compose

  We can distinguish in two main categories: ```docker-compose``` and ```docker``` commands.\

  For ```docker-compose```, we can have:
  - ```build``` to **build** or rebuild services;
  - ```up``` to **start** the service (defined in the yaml file);
  - ```down``` to **stop** and remove the service.


Docker Compose works with `docker-compose <command>` commands, allowing us to manage the ecosystem's lifecycle with the following commands:
- **`up`**: Start all services defined in the`docker-compose.yml` file.
- **`down`**: Stops and removes all containers, networks, volumes defined in the compose file.
- **`build`**: Builds the the Docker images specified in services.
- **`logs`**: Views the logs of all containers in execution.
- **`scale`**: Scales up or down the number of containers.


## Docker Compose Features
- **Isolation customization**: in the context of container orchestration systems like Kubernetes, isolation customization refers to the ability to adjust how pods (containers) are isolated from each other and the underlying infrastructure; this can involve setting up network policies, security contexts, and resource quotas to ensure that containers operate securely and efficiently.
- **Volumes**: volumes are a mechanism for persisting data generated by and used by Docker containers.; they allow data to survive beyond the lifecycle of a single container instance, facilitating data persistence and sharing among containers.
- **Secrets**: Secrets are used to store sensitive information such as passwords, OAuth tokens, and ssh keys; they are designed to be tightly controlled and secure, ensuring that secrets are not exposed outside where they are intended to be used.
- **Networks**: networking is a passage through which all the isolated container communicate - there are mainly five network drivers in Docker (such as bridge, host, none, overlay, and macvlan); in Docker, networking is indeed a crucial component that allows isolated containers to communicate with each other.

#### Volumes

Un **Volume** è una meccanismo di gestione dei dati che permette di persistire e condividere dati tra i container Docker. A differenza dei dati scritti direttamente nel file system del container, i dati nei volumi persistono anche se il container viene rimosso.

### Vantaggi dei Volumes

- **Persistenza**: I dati rimangono intatti anche dopo che il container è stato rimosso.
- **Condivisione dei dati**: I volumi possono essere montati su più container, facilitando la condivisione dei dati.
- **Backup e Restore**: I volumi possono essere facilmente backuppati e ripristinati.
- **Prestazioni**: Su piattaforme come Linux, i volumi sono generalmente più performanti rispetto al bind mounting.

  - the **volumes**: with ```volume create``` we can create a volume, and with ```volume rm``` you can remove it.
  - the **network**: as the same as volumes, we can create a new network with ```network create``` and remove it with ```network rm```


### Creazione e Gestione dei Volumes

#### Creare un Volume

Puoi creare un volume usando il comando:

```bash
docker volume create my_volume
```

#### Montare un Volume su un Container

Per montare un volume su un container, usa l'opzione `-v` o `--mount`:

```bash
docker run -d -v my_volume:/path/in/container my_image
```

#### Ispezionare un Volume

Per vedere i dettagli di un volume:

```bash
docker volume inspect my_volume
```

#### Rimuovere un Volume

Per rimuovere un volume inutilizzato:

```bash
docker volume rm my_volume
```


Volumes are used to persist data generated by Docker containers. They are managed by Docker and are independent of the container's lifecycle. Volumes can be shared between containers.

**Example:**

```yaml
version: '3'
services:
  app:
    image: my-app
    volumes:
      - app-data:/var/lib/app-data
volumes:
  app-data:
```

#### 1.2.2 Bind Mounts
Bind mounts link a directory on your local machine to a container. Unlike volumes, bind mounts directly reflect changes made on the host filesystem.

**Example:**

```yaml
version: '3'
services:
  app:
    image: my-app
    volumes:
      - ./local-directory:/app
```

#### 1.2.3 Networks
Networks allow containers to communicate with each other securely. Docker Compose automatically creates a default network, but you can define custom networks.

**Example:**

```yaml
version: '3'
services:
  web:
    image: nginx
    networks:
      - frontend
  db:
    image: mysql
    networks:
      - backend
networks:
  frontend:
  backend:
```

#### 1.2.4 Secrets
Secrets are used to securely pass sensitive data (e.g., API keys, passwords) to Docker containers. They are encrypted and only accessible to containers that you specify.

**Example:**

```yaml
version: '3.1'
services:
  db:
    image: mysql
    environment:
      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password
    secrets:
      - mysql_root_password
secrets:
  mysql_root_password:
    file: ./mysql_root_password.txt
```

#### 1.2.5 Replicas
Replicas help in scaling services by defining how many instances of a service should be running.

**Example:**

```yaml
version: '3'
services:
  app:
    image: my-app
    deploy:
      replicas: 3
```

---



























____________________________________________-





### Parte 1: Tutorial sui Volumes, Networks e Replicas in Docker

---








## Networks

### Cos'è una Network?

Una **Network** Docker è un'entità virtuale che permette ai container di comunicare tra loro in un ambiente isolato. Docker crea automaticamente una network chiamata `bridge` per ogni container, ma è possibile creare e configurare network personalizzate.

### Tipi di Networks

- **Bridge**: Network standard per la comunicazione tra container su un singolo host.
- **Host**: I container condividono la network dell'host, con accesso diretto alle sue interfacce di rete.
- **Overlay**: Usata per collegare container che risiedono su diversi host Docker.
- **None**: Nessuna network è configurata; utile per container completamente isolati.

### Creazione e Gestione delle Networks

#### Creare una Network

Per creare una network:

```bash
docker network create my_network
```

#### Collegare un Container a una Network

Puoi collegare un container a una network specifica usando l'opzione `--network`:

```bash
docker run -d --network my_network my_image
```

#### Ispezionare una Network

Per vedere i dettagli di una network:

```bash
docker network inspect my_network
```

#### Rimuovere una Network

Per rimuovere una network non utilizzata:

```bash
docker network rm my_network
```

## Replicas

### Cos'è una Replica?

Una **Replica** in Docker si riferisce alla capacità di eseguire più istanze (o repliche) dello stesso container come parte di un servizio Docker Swarm. Questo è particolarmente utile per scalare i servizi orizzontalmente, migliorando la disponibilità e la resilienza dell'applicazione.

### Vantaggi delle Replicas

- **Scalabilità**: Aumenta il numero di istanze del servizio per gestire un carico maggiore.
- **Affidabilità**: Migliora la tolleranza ai guasti; se una replica fallisce, le altre continuano a funzionare.
- **Bilanciamento del carico**: Le richieste possono essere distribuite uniformemente tra le varie repliche.

### Creazione e Gestione delle Replicas

#### Creare un Servizio con Replicas

Per creare un servizio con più repliche in Docker Swarm:

```bash
docker service create --replicas 3 --name my_service my_image
```

#### Scalare un Servizio

Puoi scalare il numero di repliche di un servizio esistente:

```bash
docker service scale my_service=5
```

#### Ispezionare un Servizio

Per vedere i dettagli di un servizio, inclusi il numero di repliche:

```bash
docker service inspect my_service
```

#### Rimuovere un Servizio

Per rimuovere un servizio e tutte le sue repliche:

```bash
docker service rm my_service
```








